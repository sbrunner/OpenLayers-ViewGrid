Based on http://trac.osgeo.org/openlayers/ticket/2352
